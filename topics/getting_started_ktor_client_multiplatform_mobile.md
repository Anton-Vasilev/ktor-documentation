[//]: # (title: Creating a cross-platform mobile application)


In this tutorial, we'll create a simple cross-platform application for sending a request and receiving a response.


## Prerequisites {id="prerequisites"}

[Set up an environment](https://kotlinlang.org/docs/multiplatform-mobile-setup.html)

## Create a new project {id="new-project"}

## Configure the build script {id="build-script"}

Open the `shared/build.gradle.kts` file.

### Add Ktor dependency {id="ktor-dependency"}

```kotlin
val commonMain by getting {
    dependencies {
        implementation("io.ktor:ktor-client-core:%ktor_version%")
    }
}
```
{interpolate-variables="true"}

### Add engine dependencies {id="engine-dependency"}

[Engine](http-client_engines.md) - Android:

```kotlin
val androidMain by getting {
    dependencies {
        implementation("io.ktor:ktor-client-okhttp:%ktor_version%")
    }
}
```

iOS:

```kotlin
val iosMain by creating {
    dependsOn(commonMain)
    // ...
    dependencies {
        implementation("io.ktor:ktor-client-darwin:%ktor_version%")
    }
}
```

### Coroutines {id="coroutines"}

https://kotlinlang.org/docs/multiplatform-mobile-concurrency-and-coroutines.html#multithreaded-coroutines

## Code {id="code"}

### Shared code {id="shared-code"}

File `shared/src/commonMain/kotlin/com/example/kmmapplication/Greeting.kt`,
Extend the `Greeting` class generated by the wizard.
Client without engine specified explicitly. Selected at compile time.

```kotlin
class Greeting {
    private val client = HttpClient()
    suspend fun getHtml(): String {
        val response = client.get("https://ktor.io")
        return response.bodyAsText()
    }
}
```

### Android code {id="android-activity"}

File `androidApp/src/main/java/com/example/kmmapplication2/android/MainActivity.kt`:

```kotlin
class MainActivity : AppCompatActivity() {
    private val mainScope = MainScope()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        val tv: TextView = findViewById(R.id.text_view)
        tv.text = "Loading..."
        mainScope.launch {
            kotlin.runCatching {
                Greeting().getHtml()
            }.onSuccess {
                tv.text = it
            }.onFailure {
                tv.text = "Error: ${it.localizedMessage}"
            }
        }
    }
}
```

### iOS code {id="ios-view"}

Suspending functions are available as functions with callbacks.

File `iosApp/iosApp/ContentView.swift`:

```Swift
struct ContentView: View {
	let greeting = Greeting()

	@State var greet = "Loading..."

	func load() {
        greeting.getHtml { result, error in
            if let result = result {
                self.greet = result
            } else if let error = error {
                greet = "Error: \(error)"
            }
        }
    }

	var body: some View {
		Text(greet).onAppear() {
            load()
        }
	}
}
```

## Internet access {id="access"}

Open `androidApp/src/main/AndroidManifest.xml`:

```xml
<manifest>
    <uses-permission android:name="android.permission.INTERNET" />
    <application>
        ...
    </application>
</manifest> 
```

## Run you application {id="run"}

[](https://kotlinlang.org/docs/multiplatform-mobile-create-first-app.html#run-your-application)


